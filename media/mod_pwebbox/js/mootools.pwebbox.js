
/**
* @version 1.0
* @package PWebBox
* @copyright © 2012 Majestic Media sp. z o.o., All rights reserved. http://www.perfect-web.co
* @license GNU General Public Licence http://www.gnu.org/licenses/gpl-3.0.html
* @author Piotr Moćko
*
* Mootools 1.3.2+, 1.4.5+
*/
var pwebBoxes=pwebBoxes||[];(function(a){pwebBox=new Class({Implements:[Options,Events],options:{id:"",prefix:"pwebbox",debug:false,openOnLoad:false,closeOther:true,reposition:true,vertical:false,position:"left",layout:"default",modal:{x:580,y:320,overlayOpacity:0.7,classWindow:"",iframe:false},onTrack:Class.empty,onShow:Class.empty,onHide:Class.empty},tracked:false,initialize:function(b){this.setOptions(b);this.options.prefix=this.options.prefix+this.options.id;this.Toggler=a(this.options.prefix+"_toggler");if(this.options.layout=="default"){this.horizontal=(!this.options.vertical&&(this.options.position=="left"||this.options.position=="right"));this.hidden=true;this.Box=a(this.options.prefix+(this.horizontal?"_box":""));this.fx=new Fx.Tween(this.Box,{property:this.options.position});this.size=this.Box.getSize();if(Browser.ie8){this.size=this.Box.getSize()}this.position=0-(this.options.position=="left"||this.options.position=="right"?this.size.x:this.size.y);if(this.horizontal){a(this.options.prefix).setStyles({width:0,height:0})}this.Box.setStyle(this.options.position,this.position);if(this.options.reposition&&(this.options.position=="left"||this.options.position=="right")){this.reposition();window.addEvent("resize",function(){this.reposition()}.bind(this))}if(this.options.closeOther){pwebBoxes.push(this)}}else{if(this.options.layout=="modal"){this.modal=SqueezeBox;this.modal.initialize({});a(this.options.prefix+"_modal_clone").removeProperty("rel")}else{if(this.options.layout=="tab"){this.Toggler.addEvent("click",function(){if(!this.tracked){this.tracked=true;this.fireEvent("onTrack")}}.bind(this))}}}a(this.options.prefix).inject($$("body")[0]);if(this.options.layout!="tab"){$$("."+this.options.prefix+"_toggler").each(function(c){c.addEvent("click",function(d){d.stop();this.toggleBox()}.bind(this))}.bind(this));if(this.options.openOnLoad){this.toggleBox()}}},toggleBox:function(d){if(typeof d=="undefined"){d=-1}if(this.options.layout=="default"){if(this.Toggler){if((!this.hidden&&d==-1)||d==0){this.Toggler.removeClass("active");this.fx.start(this.position);this.hidden=true;this.fireEvent("onHide")}else{if((this.hidden&&d==-1)||d==1){if(this.options.closeOther){pwebBoxes.each(function(e){if(e.options.id!=this.options.id){e.toggleBox(0)}}.bind(this))}this.Toggler.addClass("active");this.fx.start(0);this.hidden=false;this.fireEvent("onShow");if(!this.tracked){this.tracked=true;this.fireEvent("onTrack")}}}}}else{if(this.options.layout=="modal"){var c=window.getSize().y-40;var b=this.options.modal.y?(this.options.modal.y>c?c:this.options.modal.y):c;this.modal.fromElement(a(this.options.prefix+"_modal_clone"),{handler:this.options.modal.iframe?"iframe":"clone",size:{x:this.options.modal.x,y:b},overlayOpacity:this.options.modal.overlayOpacity,classWindow:"pwebBoxWindow "+this.options.prefix+"Window "+this.options.modal.classWindow,onOpen:function(){var e=this.modal.element.get("id");if(e&&e.indexOf(this.options.prefix)!=-1){if(!this.options.modal.iframe){if(this.Toggler){this.Toggler.addClass("active")}a(this.options.prefix+"_container").inject(a("sbox-content")).setStyle("display","block")}this.fireEvent("onShow");if(!this.tracked){this.tracked=true;this.fireEvent("onTrack")}}}.bind(this),onClose:function(){var e=this.modal.element.get("id");if(e&&e.indexOf(this.options.prefix)!=-1){if(!this.options.modal.iframe){if(this.Toggler){this.Toggler.removeClass("active")}a(this.options.prefix+"_container").setStyle("display","none").inject(a(this.options.prefix))}this.fireEvent("onHide")}}.bind(this)})}}},reposition:function(){var c=a(this.options.prefix).getTop();if(c>0){var b=window.getHeight();var d=b-c-this.size.y;if(d<0){d=Math.abs(d);if(d<=c){c-=d}else{c=-10}a(this.options.prefix).setStyle("top",c)}}}})})(document.id);